{% assign item = include.item %}
{% assign aid = item.title | slugify %}
<div class="d-none d-md-block">
    <div class="row no-gutters border-bottom border-gray">
        <div class="col-md-3 col-xl-2 mb-md-0 p-md-3">
            <img data-src="{{ item.cover }}" alt="{{ item.title }}" class="lazy w-100 rounded-sm" src="assets/images/empty_300x200.png">
        </div>
        <div class="col-md-9 col-xl-10 p-3 pl-md-0">
            <h5 class="mt-0 mb-1 font-weight-normal">{{ item.title }}</h5>
            <p class="mt-0 mb-0 small">{% include widgets/author_list.html authors=item.authors %}</p>
            <p class="mt-0 mb-0 small">{{item.pub_pre}}<i>{{ item.pub }}</i>{{ item.pub_post }} {{ item.pub_date }} {{ item.pub_last }}</p>
            <p class="mt-0 mb-0 small text-muted">
                <span id="abs-{{ aid }}-short">{{ item.abstract | truncatewords: 40, '…' }}</span>
                <span id="abs-{{ aid }}-full" class="d-none">{{ item.abstract }}</span>
                {% if item.abstract and item.abstract.size > 0 %}
                <a href="javascript:void(0)" class="ml-1" data-toggle="abstract" data-target="{{ aid }}" aria-expanded="false">Read more</a>
                {% endif %}
            </p>
            
            <p class="small pb-0 mb-0 lh-125 text-muted abstract-links">
                {% for link in item.links %}
                {% if link[1].url %}
                <a target="{{ link[1]['target'] }}" href="{{ link[1]['url'] }}">[{{ link[0] }}]</a>
                {% else %}
                <a target="_blank" href="{{ link[1] }}">[{{ link[0] }}]</a>
                {% endif %}
                {% endfor %}
            </p>

        </div>
    </div>
</div>

<div class="card w-100 d-md-none border-top-0 border-right-0 border-left-0 rounded-0" style="overflow-y: scroll;">
    <img data-src="{{ item.cover }}" alt="{{ item.title }}" class="lazy card-img w-100" src="assets/images/empty_300x200.png">
    <div class="card-img-overlay d-flex align-items-start flex-column" style="background-color: rgba(255, 255, 255, 0.85);">
        <div class="mb-auto"></div>
        <div>
            <h5 class="mt-0 mb-1 font-weight-normal">{{ item.title }}</h5>
            <p class="mt-0 mb-0 small">{% include widgets/author_list.html authors=item.authors %}</p>
            <p class="mt-0 mb-0 small">{{item.pub_pre}}<i>{{ item.pub }}</i>{{ item.pub_post }} {{ item.pub_date }} {{ item.pub_last }}</p>
            <p class="mt-0 mb-0 small text-muted d-none d-sm-block">
                <span id="abs-{{ aid }}-short-sm">{{ item.abstract | truncatewords: 40, '…' }}</span>
                <span id="abs-{{ aid }}-full-sm" class="d-none">{{ item.abstract }}</span>
                {% if item.abstract and item.abstract.size > 0 %}
                <a href="javascript:void(0)" class="ml-1" data-toggle="abstract" data-target="{{ aid }}" data-suffix="-sm" aria-expanded="false">Read more</a>
                {% endif %}
            </p>
            
            <p class="small pb-0 mb-0 lh-125 text-muted abstract-links">
                {% for link in item.links %}
                {% if link[1].url %}
                <a target="{{ link[1]['target'] }}" href="{{ link[1]['url'] }}">[{{ link[0] }}]</a>
                {% else %}
                <a target="_blank" href="{{ link[1] }}">[{{ link[0] }}]</a>
                {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>
</div>

<script>
// Initialize abstract toggles once per page (idempotent)
if (!window.__absToggleInit) {
  window.__absToggleInit = true;
  document.addEventListener('click', function(e) {
    var t = e.target;
    if (t && t.matches('[data-toggle="abstract"]')) {
      e.preventDefault();
      var id = t.getAttribute('data-target');
      var suf = t.getAttribute('data-suffix') || '';
      var shortEl = document.getElementById('abs-' + id + '-short' + suf);
      var fullEl  = document.getElementById('abs-' + id + '-full' + suf);
      if (!shortEl || !fullEl) return;
      var expanded = t.getAttribute('aria-expanded') === 'true';
      if (expanded) {
        fullEl.classList.add('d-none');
        shortEl.classList.remove('d-none');
        t.textContent = 'Read more';
        t.setAttribute('aria-expanded', 'false');
      } else {
        shortEl.classList.add('d-none');
        fullEl.classList.remove('d-none');
        t.textContent = 'Read less';
        t.setAttribute('aria-expanded', 'true');
      }
    }
  }, false);
}
</script>